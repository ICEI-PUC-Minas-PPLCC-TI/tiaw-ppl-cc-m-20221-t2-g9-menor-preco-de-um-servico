<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Adicionar um serviço</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css"
      integrity="sha512-KfkfwYDsLkIlwQp6LFnl8zNdLGxu9YAA1QvwINks4PhcElQSvqcyVLLD9aMhXd13uQjoXtEKNosOWaZqXgel0g=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/water.css@2/out/light.css"
    />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <nav>
      <ul>
        <li><a href="todos.html">Lista de todos os serviços</a></li>
      </ul>
    </nav>
    <h1>Seus serviços</h1>
    <div id="main"></div>
    <a href="cadastrar.html">
      <button id="add">
        Adicionar serviço
        <i style="margin-left: 6px" class="fa fa-add"></i>
      </button>
    </a>
  </body>

  <script>
    del = function (index) {
      let services = JSON.parse(localStorage.getItem("services"));
      services.splice(index, 1);
      localStorage.setItem("services", JSON.stringify(services));
      setServices();
    };

    setServices = function () {
      let services = localStorage.getItem("services");
      if (services) services = JSON.parse(services);
      else {
        services = [
          {
            user: { id: 2, name: "Ciclano do Queijo" },
            name: "Internet 100 megas",
            enterprise: "CLARO",
            price: 30,
            notes:
              "Ameaçei cancelar e eles me deram um desconto de 40 pra 30 sem perder nada.",
          },
          {
            user: { id: 3, name: "Arthur Ricardo" },
            name: "Água",
            enterprise: "Copasa",
            price: 40,
          },
          {
            user: { id: 5, name: "Joaquim da Silva" },
            name: "Telefone fixo",
            enterprise: "CLARO",
            price: 29.9,
          },
          {
            user: { id: 2, name: "Ciclano do Queijo" },
            name: "Assinatura",
            enterprise: "Netflix",
            price: 10,
          },
          {
            user: { id: 5, name: "Joaquim da Silva" },
            name: "Televisão",
            enterprise: "CLARO",
            price: 49.9,
          },
          {
            user: { id: 3, name: "Arthur Ricardo" },
            name: "40 megas celular",
            enterprise: "CLARO",
            price: 29.9,
            notes:
              "Disse que a OI tinha a mesma coisa mais barato e abaixaram o preço.",
          },
          {
            user: { id: 7, name: "Afonsino Augusto" },
            name: "Internet 100 megas",
            enterprise: "GVT",
            price: 89.99,
            notes:
              "Peguei uma empresa de internet lá do Acre e usei como comparação e eles abaixaram até ficar igual o da empresa do Acre.",
          },
          {
            user: { id: 3, name: "Arthur Ricardo" },
            name: "Energia",
            enterprise: "CEMIG",
            price: 200,
          },
          {
            user: { id: 27, name: "João Pedro" },
            name: "Seguro automóvel",
            enterprise: "Bradesco Seguros",
            price: 22.50,
            notes: "Plano Start"
          },
          {
            user: { id: 27, name: "João Pedro" },
            name: "Plano dental",
            enterprise: "Bradesco Seguros",
            price: 80.99,
          },
          {
            user: { id: 27, name: "João Pedro" },
            name: "Plano de Saúde",
            enterprise: "Bradesco Seguros",
            price: 127.88,
            notes:
              "Dão desconto se você tiver algum familiar que também usa o plano deles",
          },
          {
            user: { id: 7, name: "Afonsino Augusto" },
            name: "Assinatura",
            enterprise: "Spotify",
            price: 8.99,
            notes:
              "Promoção que fizeram no natal",
          },
          {
            user: { id: 2, name: "Ciclano do Queijo" },
            name: "Energia",
            enterprise: "CEMIG",
            price: 127.5,
            notes:
              "Se você ligar e dizer que você recebe menos que 3 salários mínimos eles reduzem sua conta de acordo com algua regra nova do governo lá.",
          },
        ];
        localStorage.setItem("services", JSON.stringify(services));
      }

      let html = "";
      const userId = 2;
      services.forEach((s, i) => {
        if (userId != s.user.id) return;

        if (!s.notes) s.notes = "";
        html += `
    <details>
      <summary style="width: 100%">
        ${s.enterprise} - ${s.name} - R$ ${s.price}
      </summary>
      ${s.notes}
      <button id="trash" onclick="del(${i})">
        <i class="fa fa-trash"> </i>
      </button>
    </details>
    `;
      });

      document.getElementById("main").innerHTML = html;
    };

    setServices();
  </script>
</html>
